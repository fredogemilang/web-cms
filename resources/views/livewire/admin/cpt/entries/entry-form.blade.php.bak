<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content Column -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Header -->
        <div class="flex items-center gap-4">
            <a href="{{ route('admin.cpt.entries.index', $postType->slug) }}" class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-[#272B30] rounded-xl transition-all">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20">
                    <span class="material-symbols-outlined text-white">{{ $postType->icon }}</span>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900 dark:text-white">
                        {{ $isEdit ? 'Edit' : 'Add New' }} {{ $postType->singular_label }}
                    </h1>
                    <p class="text-sm text-gray-500 dark:text-gray-400">{{ $postType->description ?? '' }}</p>
                </div>
            </div>
        </div>

        <!-- Title -->
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 p-6">
            <input 
                type="text" 
                wire:model.live.debounce.300ms="title"
                placeholder="Enter title here..."
                class="w-full text-2xl font-bold bg-transparent border-0 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-0 p-0"
            >
            @error('title')
                <p class="mt-2 text-sm text-red-500">{{ $message }}</p>
            @enderror
            
            <div class="flex items-center gap-2 mt-3 text-sm text-gray-500 dark:text-gray-400">
                <span>Permalink:</span>
                <span class="text-gray-700 dark:text-gray-300">/{{ $postType->slug }}/</span>
                <input 
                    type="text" 
                    wire:model="slug"
                    class="flex-1 px-2 py-1 bg-gray-50 dark:bg-[#272B30] border border-gray-200 dark:border-gray-700 rounded text-gray-700 dark:text-gray-300 text-sm focus:ring-1 focus:ring-blue-500"
                >
                <button type="button" wire:click="generateSlug" class="p-1 text-gray-400 hover:text-blue-600" title="Regenerate slug">
                    <span class="material-symbols-outlined text-sm">refresh</span>
                </button>
            </div>
            @error('slug')
                <p class="mt-1 text-sm text-red-500">{{ $message }}</p>
            @enderror
        </div>

        <!-- Content Editor -->
        @if(in_array('editor', $postType->supports ?? []))
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <h3 class="font-semibold text-gray-900 dark:text-white">Content</h3>
            </div>
            <div class="p-6">
                <textarea 
                    wire:model="content"
                    rows="15"
                    placeholder="Write your content here..."
                    class="w-full px-4 py-3 bg-gray-50 dark:bg-[#272B30] border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-y"
                ></textarea>
            </div>
        </div>
        @endif

        <!-- Excerpt -->
        @if(in_array('excerpt', $postType->supports ?? []))
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <h3 class="font-semibold text-gray-900 dark:text-white">Excerpt</h3>
            </div>
            <div class="p-6">
                <textarea 
                    wire:model="excerpt"
                    rows="3"
                    placeholder="Write a short description..."
                    class="w-full px-4 py-3 bg-gray-50 dark:bg-[#272B30] border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"
                ></textarea>
            </div>
        </div>
        @endif

        <!-- Meta Boxes (Normal & Advanced) -->
        @foreach($metaBoxes as $box)
            @if(in_array($box['context'], ['normal', 'advanced']) && isset($groupedFields[$box['id']]))
                <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
                    <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                        <h3 class="font-semibold text-gray-900 dark:text-white">{{ $box['title'] }}</h3>
                    </div>
                    <div class="p-6 space-y-4">
                        @foreach($groupedFields[$box['id']] as $field)
                            @include('livewire.admin.cpt.entries.partials.field-render', ['field' => $field])
                        @endforeach
                    </div>
                </div>
            @endif
        @endforeach

        <!-- Default Meta Fields (Not in any box) -->
        @if(isset($groupedFields['default']))
            <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
                <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                    <h3 class="font-semibold text-gray-900 dark:text-white">Custom Fields</h3>
                </div>
                <div class="p-6 space-y-4">
                    @foreach($groupedFields['default'] as $field)
                        @include('livewire.admin.cpt.entries.partials.field-render', ['field' => $field])
                    @endforeach
                </div>
            </div>
        @endif
    </div>

    <!-- Sidebar Column -->
    <div class="space-y-6">
        <!-- Publish Box -->
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <h3 class="font-semibold text-gray-900 dark:text-white">Publish</h3>
            </div>
            <div class="p-4 space-y-4">
                <!-- Status -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                    <select 
                        wire:model="status"
                        class="w-full px-3 py-2 bg-gray-50 dark:bg-[#272B30] border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                    >
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>

                <!-- Publish Date -->
                @if($status === 'scheduled' || $status === 'published')
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Publish Date</label>
                    <input 
                        type="datetime-local"
                        wire:model="publishedAt"
                        class="w-full px-3 py-2 bg-gray-50 dark:bg-[#272B30] border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                    >
                </div>
                @endif

                <!-- Actions -->
                <div class="flex flex-col gap-2 pt-2">
                    <button 
                        type="button"
                        wire:click="publish"
                        class="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl transition-all shadow-lg shadow-blue-500/25 hover:shadow-blue-500/40"
                    >
                        <span class="material-symbols-outlined text-lg">publish</span>
                        {{ $isEdit ? 'Update' : 'Publish' }}
                    </button>
                    <button 
                        type="button"
                        wire:click="saveAsDraft"
                        class="w-full px-4 py-2.5 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-[#272B30] hover:bg-gray-200 dark:hover:bg-[#32363b] font-medium rounded-xl transition-all text-sm"
                    >
                        Save as Draft
                    </button>
                </div>
            </div>
        </div>

        <!-- Meta Boxes (Side) -->
        @foreach($metaBoxes as $box)
            @if($box['context'] === 'side' && isset($groupedFields[$box['id']]))
                <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
                    <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                        <h3 class="font-semibold text-gray-900 dark:text-white">{{ $box['title'] }}</h3>
                    </div>
                    <div class="p-4 space-y-4">
                        @foreach($groupedFields[$box['id']] as $field)
                            @include('livewire.admin.cpt.entries.partials.field-render', ['field' => $field])
                        @endforeach
                    </div>
                </div>
            @endif
        @endforeach

        <!-- Featured Image -->
        @if(in_array('thumbnail', $postType->supports ?? []))
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <h3 class="font-semibold text-gray-900 dark:text-white">Featured Image</h3>
            </div>
            <div class="p-4">
                @if($featuredImage)
                    <div class="relative group">
                        <img src="{{ asset('storage/' . $featuredImage) }}" alt="Featured" class="w-full h-40 object-cover rounded-xl">
                        <button 
                            type="button"
                            wire:click="removeFeaturedImage"
                            class="absolute top-2 right-2 p-1.5 bg-red-600 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"
                        >
                            <span class="material-symbols-outlined text-sm">close</span>
                        </button>
                    </div>
                @else
                    <button 
                        type="button"
                        wire:click="$set('showMediaPicker', true)"
                        class="w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 hover:border-blue-500 hover:text-blue-500 transition-all"
                    >
                        <span class="material-symbols-outlined text-3xl mb-1">add_photo_alternate</span>
                        <span class="text-sm">Set featured image</span>
                    </button>
                @endif
            </div>
        </div>
        @endif

        <!-- Parent (for hierarchical) -->
        @if($postType->is_hierarchical && $possibleParents->count() > 0)
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <h3 class="font-semibold text-gray-900 dark:text-white">Parent {{ $postType->singular_label }}</h3>
            </div>
            <div class="p-4">
                <select 
                    wire:model="parentId"
                    class="w-full px-3 py-2 bg-gray-50 dark:bg-[#272B30] border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                >
                    <option value="">(no parent)</option>
                    @foreach($possibleParents as $parent)
                        <option value="{{ $parent->id }}">{{ $parent->title }}</option>
                    @endforeach
                </select>
            </div>
        </div>
        @endif

        <!-- Taxonomies -->
        @foreach($taxonomies as $taxonomy)
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <h3 class="font-semibold text-gray-900 dark:text-white">{{ $taxonomy->plural_label }}</h3>
            </div>
            <div class="p-4">
                @if(isset($taxonomyTerms[$taxonomy->id]) && $taxonomyTerms[$taxonomy->id]->count() > 0)
                    <div class="max-h-48 overflow-y-auto space-y-2">
                        @foreach($taxonomyTerms[$taxonomy->id] as $term)
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input 
                                    type="{{ $taxonomy->is_hierarchical ? 'checkbox' : 'checkbox' }}"
                                    wire:click="toggleTerm({{ $taxonomy->id }}, {{ $term->id }})"
                                    @checked(in_array($term->id, $selectedTerms[$taxonomy->id] ?? []))
                                    class="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                >
                                <span class="text-sm text-gray-700 dark:text-gray-300">{{ $term->name }}</span>
                            </label>
                        @endforeach
                    </div>
                @else
                    <p class="text-sm text-gray-500 dark:text-gray-400">No {{ strtolower($taxonomy->plural_label) }} yet.</p>
                @endif
            </div>
        </div>
        @endforeach

        <!-- Order (for hierarchical) -->
        @if($postType->is_hierarchical)
        <div class="bg-white dark:bg-[#1A1D21] rounded-2xl shadow-sm border border-gray-200 dark:border-gray-800 overflow-hidden">
            <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <h3 class="font-semibold text-gray-900 dark:text-white">Order</h3>
            </div>
            <div class="p-4">
                <input 
                    type="number"
                    wire:model="menuOrder"
                    min="0"
                    class="w-full px-3 py-2 bg-gray-50 dark:bg-[#272B30] border border-gray-200 dark:border-gray-700 rounded-xl text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm"
                >
                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Lower number means higher priority</p>
            </div>
        </div>
        @endif
    </div>
</div>
